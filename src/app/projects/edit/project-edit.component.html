<main-header>
  <div class="main-header-title">Edit {{project.title}}</div>
  <div class="main-header-content" style="display: flex">
    <div>
      <button (click)="save()" md-raised-button color="primary">
        <i class="fa fa-save" aria-hidden="true"></i> Save
      </button>
<!--
      <button uiSref="^" md-raised-button color="warn">
        <i class="fa fa-ban" aria-hidden="true"></i> Cancel
      </button>
-->
    </div>
  </div>
</main-header>

<div fxLayout="column" style="overflow: auto;width: 100%">
  <div fxLayout="row">
    <div fxFlex="70" class="panel">
      <div class="panel-heading">
        <h6>General</h6>
      </div>
      <div fxLayout="column" class="panel-content">
        <div fxLayout="row">
          <div fxFlex>
            <span mdTooltip="Update your project picture">
              <button md-button (click)="updatePicture()"><img src="assets/img/no-picture-icon.png"></button>
            </span>
          </div>
          <div fxFlex="80" fxLayout="column" style="padding: 20px !important;">
            <md-input-container fxFlex class="panel-content-input-container" style="margin-bottom: 10px">
              <input md-input required
                     [(ngModel)]="project.title"
                     placeholder="Name" name="title" type="text">
            </md-input-container>
            <md-input-container fxFlex class="panel-content-input-container" style="margin-bottom: 10px">
            <textarea md-input
                      [(ngModel)]="project.description"
                      [maxlength]="descriptionMaxLength"
                      placeholder="Description ({{descriptionMaxLength}} max)" name="Description" type="text"
                      style="min-height: 60px"
                      #description></textarea>
              <md-hint align="end">{{description.value.length}} / {{descriptionMaxLength}}</md-hint>
            </md-input-container>
          </div>
        </div>
        <div fxLayout="row" style="margin: 20px">
          <md-select
              placeholder="Sub-project of"
              fxFlex="70"
              name="subProject" type="">
            <md-option *ngFor="let project of projects" [value]="project">{{project.title}}</md-option>
          </md-select>
        </div>
        <div fxLayout="row" style="margin: 20px">
          <md-select [(ngModel)]="project.manager"
                     fxFlex="70"
                     placeholder="Manager"
                     name="manager" type="">
            <md-option *ngFor="let user of availableUsers" [value]="user">{{user.username}}</md-option>
          </md-select>
        </div>
      </div>
    </div>
    <div fxFlex fxLayout="column">
      <div *ngIf="!create" class="panel">
        <div class="panel-heading">
          <h6>History</h6>
        </div>
        <div class="panel-content">
          <md-list>
            <md-list-item>
              <h4 md-line style="overflow-x: visible ">Created</h4>
              <p md-line> {{project.createdDate | amTimeAgo }} by {{project.createdUser.fullName}}</p>
            </md-list-item>
            <md-list-item>
              <h4 md-line style="overflow-x: visible">Updated</h4>
              <p md-line> {{project.lastModifiedDate | amTimeAgo }} by {{ project.lastModifiedUser.fullName}}</p>
            </md-list-item>
          </md-list>
        </div>
      </div>
      <div class="panel">
        <div class="panel-heading">
          <h6>Authorized Users</h6>
        </div>
        <div class="panel-content" style="margin-bottom: 10px;">
          <div fxLayout="row">
            <ng2-completer-md
                [dataService]="dataService"
                [(inputName)]="searchStr"
                [minSearchLength]="0"
                [placeholder]="'Add user...'"
                [clearSelected]=true
                (selected)="authorizeUser($event)"
                style="flex:auto;flex-direction: row; width: 100%">
            </ng2-completer-md>
          </div>
          <div fxLayout="column" style="max-height: 320px; overflow: auto">
            <md-card *ngFor="let user of project.projectUsers" style="margin-bottom: 5px;">
              <md-card-header fxFlex fxLayout="row">
                <img md-card-avatar src="assets/img/avatar_m.png">
                <md-card-title>{{user.fullName}}</md-card-title>
                <md-card-subtitle>Project Manager</md-card-subtitle>
                <button role="button" (click)="removeUserFromProject(user)"><i class="fa fa-trash-o" aria-hidden="true"></i></button>
              </md-card-header>
            </md-card>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
